# EVPåˆè§„æ€§æŠ¥å‘Šç”Ÿæˆä¸é€šçŸ¥ç³»ç»Ÿ - æŠ€æœ¯æ–‡æ¡£ï¼ˆä¼˜åŒ–ç‰ˆV1.5ï¼‰
## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°
ï¼ˆå†…å®¹ä¿æŒä¸å˜ï¼‰


## äºŒã€ç¯å¢ƒä¾èµ–
ï¼ˆå†…å®¹ä¿æŒä¸å˜ï¼‰


## ä¸‰ã€ç›®å½•ç»“æ„è§„èŒƒ
### 3.1 æœ€ç»ˆç›®å½•ç»“æ„ï¼ˆåŒ¹é…ç”¨æˆ·ç°æœ‰æ–‡ä»¶ï¼‰
```
EVP report/                # æ ¹ç›®å½•ï¼ˆä¸ä¸»ç¨‹åºè„šæœ¬åŒçº§ï¼‰
â”œâ”€ RawData/                # å­˜æ”¾åˆè§„æ€§åŸå§‹æ•°æ®æ–‡ä»¶
â”œâ”€ MasterData/             # å­˜æ”¾è®¾å¤‡ä¸»æ•°æ®æ–‡ä»¶
â”œâ”€ EVP_report_Compliance/   # è¾“å‡ºæŠ¥å‘Šç›®å½•
â”œâ”€ Log/                    # ç³»ç»Ÿæ—¥å¿—ç›®å½•
â”œâ”€ evp_compliance_base.py  # ä¸»ç¨‹åºè„šæœ¬ï¼ˆéœ€é€‚é…è°ƒç”¨ï¼‰
â”œâ”€ email_sender.py         # ç”¨æˆ·ç°æœ‰é‚®ä»¶å‘é€æ¨¡å—ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰
â””â”€ email_config.json       # é‚®ä»¶é…ç½®æ–‡ä»¶ï¼ˆéœ€åŒ¹é…ç”¨æˆ·æ¨¡å—æ ¼å¼ï¼‰
```


## å››ã€ç”¨æˆ·ç°æœ‰`email_sender.py`è§£æï¼ˆæ–°å¢ç« èŠ‚ï¼‰
### 4.1 æ ¸å¿ƒåŠŸèƒ½ä¸ä¼˜åŠ¿
ä½ çš„`email_sender.py`å·²å…·å¤‡å®Œæ•´çš„é‚®ä»¶å‘é€èƒ½åŠ›ï¼Œæ— éœ€é¢å¤–ä¿®æ”¹ï¼Œæ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š
- **Outlookæ·±åº¦é€‚é…**ï¼šè‡ªåŠ¨åˆå§‹åŒ–Outlookå®¢æˆ·ç«¯ã€è·å–é»˜è®¤å‘é€è´¦æˆ·ï¼Œæ”¯æŒå‘é€ç¡®è®¤æ ¡éªŒ
- **å¥å£®çš„é‡è¯•æœºåˆ¶**ï¼šå†…ç½®é‡è¯•é€»è¾‘ï¼ˆé»˜è®¤2æ¬¡ï¼‰ï¼Œå¤±è´¥åè‡ªåŠ¨ç­‰å¾…é‡è¯•ï¼Œé¿å…ç½‘ç»œæ³¢åŠ¨å¯¼è‡´çš„å‘é€å¤±è´¥
- **å®‰å…¨çš„é™çº§ç­–ç•¥**ï¼šæ‰€æœ‰é‡è¯•å¤±è´¥åè‡ªåŠ¨ä¿å­˜é‚®ä»¶åˆ°è‰ç¨¿ç®±ï¼Œæ”¯æŒæ‰‹åŠ¨å‘é€
- **é…ç½®åŒ–ç®¡ç†**ï¼šä»`email_config.json`è¯»å–æ”¶ä»¶äºº/æŠ„é€åˆ—è¡¨ï¼Œæ— éœ€ç¡¬ç¼–ç 
- **å‘é€çŠ¶æ€æ ¡éªŒ**ï¼šé€šè¿‡â€œå·²å‘é€é‚®ä»¶â€æ–‡ä»¶å¤¹ç¡®è®¤å‘é€ç»“æœï¼Œé¿å…â€œå‡å‘é€â€é—®é¢˜

### 4.2 å…³é”®å‡½æ•°å‚æ•°è¯´æ˜
ä½ çš„`send_email`å‡½æ•°æ˜¯æ ¸å¿ƒå…¥å£ï¼Œå‚æ•°ä¸é€»è¾‘éœ€é‡ç‚¹å…³æ³¨ï¼š
| å‚æ•°å         | ç±»å‹       | è¯´æ˜                                                                 | ç¤ºä¾‹å€¼                                  |
|----------------|------------|----------------------------------------------------------------------|-----------------------------------------|
| `subject`      | å­—ç¬¦ä¸²     | é‚®ä»¶æ ‡é¢˜ï¼ˆéœ€ä¸`email_config.json`ä¸­`reports`ä¸‹çš„keyå®Œå…¨ä¸€è‡´ï¼‰         | "EVPåˆè§„æƒ…å†µå’Œä»»åŠ¡æé†’"                |
| `html_content` | å­—ç¬¦ä¸²     | é‚®ä»¶æ­£æ–‡ï¼ˆHTMLæ ¼å¼ï¼Œæ”¯æŒè¡¨æ ¼ã€åˆ—è¡¨ç­‰å¯Œæ–‡æœ¬ï¼‰                          | `<h3>æŠ¥å‘Šå·²ç”Ÿæˆ</h3><p>è¯¦æƒ…è§é™„ä»¶</p>`  |
| `config_path`  | å­—ç¬¦ä¸²     | é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤åŒç›®å½•ä¸‹`email_config.json`ï¼Œæ— éœ€æ‰‹åŠ¨ä¼ é€’ï¼‰         | Noneï¼ˆä½¿ç”¨é»˜è®¤è·¯å¾„ï¼‰                    |
| `max_retries`  | æ•´æ•°       | æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤2æ¬¡ï¼Œå¯è¦†ç›–ï¼‰                                       | 3                                       |

### 4.3 ä¾èµ–çš„`email_config.json`æ ¼å¼
ä½ çš„æ¨¡å—è¦æ±‚é…ç½®æ–‡ä»¶ä¸­é€šè¿‡**é‚®ä»¶æ ‡é¢˜**åŒ¹é…æ”¶ä»¶äººï¼Œæ ¼å¼éœ€ä¸¥æ ¼å¦‚ä¸‹ï¼ˆå…³é”®å­—æ®µä¸º`recipients`ï¼ˆæ”¶ä»¶äººï¼‰å’Œ`cc`ï¼ˆæŠ„é€ï¼‰ï¼‰ï¼š
```json
{
    "reports": {
        "EVPåˆè§„æƒ…å†µå’Œä»»åŠ¡æé†’": {  // éœ€ä¸é‚®ä»¶æ ‡é¢˜ï¼ˆsubjectï¼‰å®Œå…¨ä¸€è‡´
            "recipients": [  // ä¸»æ”¶ä»¶äººï¼ˆTOï¼‰åˆ—è¡¨ï¼ˆä»MasterDataæå–åéœ€å†™å…¥æ­¤å¤„ï¼‰
                "li.w.21@pg.com",
                "cao.dl@pg.com"
            ],
            "cc": [  // æŠ„é€ï¼ˆCCï¼‰åˆ—è¡¨
                "liang.wq.1@pg.com"
            ]
        },
        "å…¶ä»–é‚®ä»¶æ ‡é¢˜": {  // é¢„ç•™å…¶ä»–é‚®ä»¶é…ç½®
            "recipients": [],
            "cc": []
        }
    }
}
```


## äº”ã€ä¸»ç¨‹åºé€‚é…è°ƒç”¨ç”¨æˆ·`email_sender.py`çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæ–°å¢æ ¸å¿ƒç« èŠ‚ï¼‰
### 5.1 é€‚é…é€»è¾‘è¯´æ˜
ä½ çš„`email_sender.py`å·²å†…ç½®**ä»é…ç½®æ–‡ä»¶è¯»å–æ”¶ä»¶äºº**å’Œ**é‡è¯•/é™çº§**é€»è¾‘ï¼Œä¸»ç¨‹åºæ— éœ€é‡å¤å¼€å‘ï¼Œåªéœ€å®Œæˆ2ä¸ªæ ¸å¿ƒåŠ¨ä½œï¼š
1. ä»MasterDataçš„Båˆ—ï¼ˆCSLï¼‰ã€Cåˆ—ï¼ˆDC Managerï¼‰æå–æ”¶ä»¶äººï¼Œæ›´æ–°åˆ°`email_config.json`çš„`recipients`å­—æ®µ
2. è°ƒç”¨ä½ çš„`send_email`å‡½æ•°ï¼Œä¼ é€’`subject`ã€`html_content`å’Œé™„ä»¶è·¯å¾„ï¼ˆéœ€é€šè¿‡é…ç½®æ–‡ä»¶é—´æ¥ä¼ é€’é™„ä»¶ï¼‰

### 5.2 ä¸»ç¨‹åºä¿®æ”¹æ­¥éª¤ï¼ˆ`evp_compliance_base.py`ï¼‰
#### æ­¥éª¤1ï¼šå¯¼å…¥ç”¨æˆ·çš„é‚®ä»¶å‘é€æ¨¡å—
åœ¨ä¸»ç¨‹åºé¡¶éƒ¨å¯¼å…¥ä½ çš„`send_email`å‡½æ•°ï¼ˆæ— éœ€ä¿®æ”¹ä½ çš„æ¨¡å—ï¼‰ï¼š
```python
# å¯¼å…¥ç”¨æˆ·ç°æœ‰é‚®ä»¶å‘é€æ¨¡å—ï¼ˆåŒç›®å½•ä¸‹ï¼‰
from email_sender import send_email as user_send_email  # é‡å‘½åé¿å…å†²çª
import pandas as pd
import os
import json
import logging
import time
# å…¶ä»–åŸæœ‰å¯¼å…¥...
```

#### æ­¥éª¤2ï¼šæ–°å¢â€œæ›´æ–°é…ç½®æ–‡ä»¶æ”¶ä»¶äººâ€å‡½æ•°
ä»MasterDataæå–B/Cåˆ—é‚®ç®±ï¼Œå†™å…¥`email_config.json`çš„`recipients`å­—æ®µï¼š
```python
def update_email_config_recipients(master_df, logger):
    """
    ä»MasterDataæå–Båˆ—ï¼ˆCSLï¼‰ã€Cåˆ—ï¼ˆDC Managerï¼‰é‚®ç®±ï¼Œæ›´æ–°åˆ°email_config.json
    """
    # 1. æå–å¹¶å»é‡æ”¶ä»¶äºº
    recipients = set()
    # æå–Båˆ—ï¼ˆCSLï¼‰
    if Config.CSL_COL in master_df.columns:
        csl_emails = master_df[Config.CSL_COL].dropna().astype(str).tolist()
        valid_csl = [e.strip() for e in csl_emails if "@" in e and "." in e.split("@")[-1]]
        recipients.update(valid_csl)
        logger.info(f"ğŸ“¥ ä»Båˆ—ï¼ˆ{Config.CSL_COL}ï¼‰æå–æœ‰æ•ˆé‚®ç®±: {len(valid_csl)}ä¸ª")
    
    # æå–Cåˆ—ï¼ˆDC Managerï¼‰
    if Config.DC_MANAGER_COL in master_df.columns:
        dc_emails = master_df[Config.DC_MANAGER_COL].dropna().astype(str).tolist()
        valid_dc = [e.strip() for e in dc_emails if "@" in e and "." in e.split("@")[-1]]
        recipients.update(valid_dc)
        logger.info(f"ğŸ“¥ ä»Cåˆ—ï¼ˆ{Config.DC_MANAGER_COL}ï¼‰æå–æœ‰æ•ˆé‚®ç®±: {len(valid_dc)}ä¸ª")
    
    if not recipients:
        logger.error("âŒ æœªä»MasterDataæå–åˆ°æœ‰æ•ˆæ”¶ä»¶äººï¼Œæ— æ³•æ›´æ–°é…ç½®æ–‡ä»¶")
        return False
    
    # 2. è¯»å–å¹¶æ›´æ–°é…ç½®æ–‡ä»¶
    config_path = Config.EMAIL_CONFIG_PATH
    try:
        with open(config_path, "r", encoding="utf-8") as f:
            config = json.load(f)
        
        # æ‰¾åˆ°åŒ¹é…é‚®ä»¶æ ‡é¢˜çš„é…ç½®ï¼Œæ›´æ–°recipients
        if Config.EMAIL_SUBJECT in config.get("reports", {}):
            config["reports"][Config.EMAIL_SUBJECT]["recipients"] = list(recipients)
            # ä¿å­˜æ›´æ–°åçš„é…ç½®
            with open(config_path, "w", encoding="utf-8") as f:
                json.dump(config, f, ensure_ascii=False, indent=4)
            logger.info(f"âœ… å·²æ›´æ–°é…ç½®æ–‡ä»¶æ”¶ä»¶äººï¼Œå…±{len(recipients)}ä¸ªæœ‰æ•ˆé‚®ç®±")
            return True
        else:
            logger.error(f"âŒ é…ç½®æ–‡ä»¶ä¸­æœªæ‰¾åˆ°é‚®ä»¶æ ‡é¢˜: {Config.EMAIL_SUBJECT}")
            return False
    except Exception as e:
        logger.error(f"âŒ æ›´æ–°é…ç½®æ–‡ä»¶å¤±è´¥: {str(e)}")
        return False
```

#### æ­¥éª¤3ï¼šä¿®æ”¹é‚®ä»¶å‘é€å‡½æ•°ï¼ˆé€‚é…ç”¨æˆ·æ¨¡å—ï¼‰
åˆ é™¤ä¸»ç¨‹åºåŸæœ‰é‡è¯•é€»è¾‘ï¼Œç›´æ¥è°ƒç”¨ä½ çš„`send_email`å‡½æ•°ï¼Œåˆ©ç”¨å…¶å†…ç½®èƒ½åŠ›ï¼š
```python
def send_notification(report_paths, stats, logger):
    """
    è°ƒç”¨ç”¨æˆ·ç°æœ‰email_sender.pyå‘é€é‚®ä»¶
    æ ¸å¿ƒï¼šé™„ä»¶é€šè¿‡HTMLå†…å®¹é—´æ¥å‘ŠçŸ¥ï¼Œé…ç½®æ–‡ä»¶ç®¡ç†æ”¶ä»¶äºº
    """
    try:
        # 1. ç”ŸæˆHTMLé‚®ä»¶æ­£æ–‡ï¼ˆåŒ…å«æŠ¥å‘Šä¿¡æ¯å’Œé™„ä»¶æç¤ºï¼‰
        attachment_info = "<br>".join([f"- {os.path.basename(path)}" for path in report_paths])
        email_body = f"""
        <html>
            <body>
                <h3>{Config.EMAIL_SUBJECT}</h3>
                <p>æœ€æ–°EVPåˆè§„æ€§æŠ¥å‘Šå·²ç”Ÿæˆï¼Œç»Ÿè®¡è¯¦æƒ…å¦‚ä¸‹ï¼š</p>
                <ul>
                    <li>æ€»è®¾å¤‡æ•°é‡: {stats['total']} å°</li>
                    <li>åˆè§„è®¾å¤‡æ•°é‡: {stats['compliant']} å°</li>
                    <li>ä¸åˆè§„è®¾å¤‡æ•°é‡: {stats['non_compliant']} å°</li>
                    <li>æœªæ‰¾åˆ°è®¾å¤‡æ•°é‡: {stats['not_found']} å°</li>
                    <li>æ•´ä½“åˆè§„ç‡: {stats['compliant_rate']}%</li>
                </ul>
                <p>æœ¬æ¬¡å‘é€çš„æŠ¥å‘Šé™„ä»¶ï¼š</p>
                <p>{attachment_info}</p>
                <p>è¯·æŸ¥æ”¶å¹¶åŠæ—¶å¤„ç†ä¸åˆè§„è®¾å¤‡ã€‚</p>
            </body>
        </html>
        """
        
        # 2. è°ƒç”¨ç”¨æˆ·çš„send_emailå‡½æ•°ï¼ˆåˆ©ç”¨å…¶å†…ç½®é‡è¯•ã€å‘é€ç¡®è®¤ï¼‰
        logger.info(f"âœ‰ï¸ å¼€å§‹è°ƒç”¨é‚®ä»¶å‘é€æ¨¡å—ï¼Œæ ‡é¢˜: {Config.EMAIL_SUBJECT}")
        # å…³é”®è°ƒç”¨ï¼šä¼ é€’æ ‡é¢˜ã€HTMLå†…å®¹ã€é‡è¯•æ¬¡æ•°ï¼ˆå¤ç”¨ç”¨æˆ·æ¨¡å—çš„max_retriesï¼‰
        send_success = user_send_email(
            subject=Config.EMAIL_SUBJECT,
            html_content=email_body,
            max_retries=Config.EMAIL_RETRY  # ä¸ä¸»ç¨‹åºé…ç½®ä¿æŒä¸€è‡´
        )
        
        if send_success:
            logger.info("âœ… é‚®ä»¶å‘é€æˆåŠŸï¼ˆç”¨æˆ·æ¨¡å—ç¡®è®¤ï¼‰")
        else:
            logger.warning("âš ï¸ é‚®ä»¶å‘é€å¤±è´¥æˆ–å·²ä¿å­˜åˆ°è‰ç¨¿ç®±ï¼ˆç”¨æˆ·æ¨¡å—åé¦ˆï¼‰")
        return send_success
    except Exception as e:
        logger.error(f"âŒ é‚®ä»¶å‘é€æµç¨‹å¼‚å¸¸: {str(e)}")
        return False
```

#### æ­¥éª¤4ï¼šä¸»ç¨‹åºè°ƒç”¨é¡ºåºè°ƒæ•´
åœ¨`main`å‡½æ•°ä¸­æŒ‰â€œæ›´æ–°é…ç½®â†’ç”ŸæˆæŠ¥å‘Šâ†’å‘é€é‚®ä»¶â€é¡ºåºæ‰§è¡Œï¼š
```python
def main():
    print("===== EVPåˆè§„æ€§æŠ¥å‘Šå·¥å…· =====")
    # 1. åˆå§‹åŒ–æ—¥å¿—å’Œè·¯å¾„
    logger, log_path = init_logger()
    logger.info("ğŸš€ ç¨‹åºå¯åŠ¨ - EVPåˆè§„æ€§æŠ¥å‘Šç”Ÿæˆå·¥å…·")
    PathManager.init_dirs()
    
    try:
        # 2. åŠ è½½æ•°æ®
        raw_df, master_df, raw_file, master_file, scorecard_data = load_data(logger)
        if raw_df is None or master_df is None:
            logger.error("âŒ æ•°æ®åŠ è½½å¤±è´¥ï¼Œç¨‹åºç»ˆæ­¢")
            return
        
        # 3. å¤„ç†æ•°æ®
        logger.info("ğŸ”„ å¼€å§‹å¤„ç†æ•°æ®...")
        result_df, stats, site_stats = process_data(master_df, raw_df, logger)
        
        # 4. ç”ŸæˆæŠ¥å‘Šï¼ˆExcel+HTMLï¼‰
        logger.info("ğŸ“ å¼€å§‹ç”ŸæˆæŠ¥å‘Š...")
        excel_report_path = generate_excel_report(result_df, stats, site_stats, scorecard_data, logger)
        html_report_path = generate_html_report(result_df, stats, site_stats, scorecard_data, logger)
        report_paths = [p for p in [excel_report_path, html_report_path] if p]
        if not report_paths:
            logger.error("âŒ æ‰€æœ‰æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Œä¸å‘é€é‚®ä»¶")
            return
        
        # 5. è‡ªåŠ¨æ‰“å¼€æŠ¥å‘Šç›®å½•
        open_report_dir(logger)
        
        # 6. å…³é”®æ­¥éª¤ï¼šæ›´æ–°é…ç½®æ–‡ä»¶æ”¶ä»¶äººï¼ˆä»MasterDataæå–ï¼‰
        logger.info("ğŸ”§ å¼€å§‹ä»MasterDataæå–æ”¶ä»¶äººå¹¶æ›´æ–°é…ç½®æ–‡ä»¶...")
        config_updated = update_email_config_recipients(master_df, logger)
        if not config_updated:
            logger.warning("âš ï¸ é…ç½®æ–‡ä»¶æœªæ›´æ–°ï¼Œå¯èƒ½å½±å“é‚®ä»¶æ”¶ä»¶äºº")
        
        # 7. è°ƒç”¨ç”¨æˆ·é‚®ä»¶æ¨¡å—å‘é€é€šçŸ¥
        send_notification(report_paths, stats, logger)
        
    except Exception as e:
        logger.error(f"ğŸ’¥ ç¨‹åºè¿è¡Œå¼‚å¸¸: {str(e)}")
        logger.error(traceback.format_exc())
    finally:
        logger.info(f"ğŸ ç¨‹åºç»“æŸ - æ—¥å¿—å·²ä¿å­˜è‡³: {log_path}\n")
```


### 5.3 å…³é”®é€‚é…ç‚¹ç¡®è®¤ï¼ˆç¡®ä¿ä½ çš„æ¨¡å—å¯æ­£å¸¸è°ƒç”¨ï¼‰
1. **é…ç½®æ–‡ä»¶å…¼å®¹æ€§**ï¼š
   - ä¸»ç¨‹åºçš„`Config.EMAIL_SUBJECT`å¿…é¡»ä¸`email_config.json`ä¸­`reports`ä¸‹çš„keyå®Œå…¨ä¸€è‡´ï¼ˆå¦‚å‡ä¸ºâ€œEVPåˆè§„æƒ…å†µå’Œä»»åŠ¡æé†’â€ï¼‰
   - ä½ çš„æ¨¡å—è¯»å–`recipients`ä½œä¸ºä¸»æ”¶ä»¶äººï¼Œä¸»ç¨‹åºä¼šè‡ªåŠ¨ä»MasterDataæå–å¹¶æ›´æ–°æ­¤å­—æ®µï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤

2. **é™„ä»¶å¤„ç†**ï¼š
   - ä½ çš„`email_sender.py`å½“å‰æœªç›´æ¥æ”¯æŒé™„ä»¶å‚æ•°ï¼ˆåŸä»£ç ä¸­æ— `attachments`å‚æ•°ï¼‰ï¼Œå› æ­¤ä¸»ç¨‹åºé€šè¿‡**HTMLæ­£æ–‡åˆ—å‡ºé™„ä»¶åç§°**ï¼ŒåŒæ—¶éœ€æ‰‹åŠ¨å°†æŠ¥å‘Šè·¯å¾„æ·»åŠ åˆ°ä½ çš„æ¨¡å—ä¸­ï¼ˆè‹¥éœ€è‡ªåŠ¨é™„åŠ é™„ä»¶ï¼Œéœ€å¾®è°ƒä½ çš„æ¨¡å—ï¼Œè§ä¸‹æ–¹â€œå¯é€‰ä¼˜åŒ–â€ï¼‰

3. **é‡è¯•æœºåˆ¶ååŒ**ï¼š
   - ä¸»ç¨‹åº`Config.EMAIL_RETRY`ï¼ˆé‡è¯•æ¬¡æ•°ï¼‰ä¼ é€’ç»™ä½ çš„`max_retries`å‚æ•°ï¼Œä¿æŒé‡è¯•ç­–ç•¥ä¸€è‡´
   - ä½ çš„æ¨¡å—å·²å†…ç½®é‡è¯•é—´éš”ï¼ˆ10ç§’ï¼‰ï¼Œä¸»ç¨‹åºæ— éœ€é¢å¤–è®¾ç½®


### 5.4 å¯é€‰ï¼šä¸ºä½ çš„`email_sender.py`æ·»åŠ é™„ä»¶åŠŸèƒ½ï¼ˆå¦‚éœ€è‡ªåŠ¨é™„åŠ ï¼‰
è‹¥å¸Œæœ›æŠ¥å‘Šè‡ªåŠ¨ä½œä¸ºé™„ä»¶å‘é€ï¼Œå¯åœ¨ä½ çš„`send_email`å‡½æ•°ä¸­æ·»åŠ é™„ä»¶å‚æ•°ï¼ˆä»…éœ€ä¿®æ”¹3å¤„ï¼‰ï¼š
```python
# ä¿®æ”¹1ï¼šåœ¨send_emailå‡½æ•°å‚æ•°ä¸­æ·»åŠ attachments
def send_email(subject, html_content, config_path=None, max_retries=2, attachments=None):
    # ä¿®æ”¹2ï¼šåœ¨åˆ›å»ºé‚®ä»¶å¯¹è±¡åæ·»åŠ é™„ä»¶
    mail = outlook.CreateItem(0)
    mail.Subject = subject
    mail.HTMLBody = html_content
    mail.To = ";".join(recipients)
    mail.CC = ";".join(cc)
    
    # æ–°å¢ï¼šæ·»åŠ é™„ä»¶
    if attachments and isinstance(attachments, list):
        for att_path in attachments:
            if os.path.exists(att_path):
                mail.Attachments.Add(att_path)
                print(f"ğŸ“ å·²æ·»åŠ é™„ä»¶: {os.path.basename(att_path)}")
            else:
                print(f"âš ï¸ é™„ä»¶ä¸å­˜åœ¨: {att_path}ï¼Œå·²è·³è¿‡")
    
    # ä¿®æ”¹3ï¼šåœ¨ä¸»ç¨‹åºè°ƒç”¨æ—¶ä¼ é€’attachmentså‚æ•°
    # ï¼ˆä¸»ç¨‹åºsend_notificationå‡½æ•°ä¸­è°ƒæ•´è°ƒç”¨ï¼‰
    send_success = user_send_email(
        subject=Config.EMAIL_SUBJECT,
        html_content=email_body,
        max_retries=Config.EMAIL_RETRY,
        attachments=report_paths  # æ–°å¢ä¼ é€’é™„ä»¶è·¯å¾„
    )
```


## å…­ã€æµ‹è¯•éªŒè¯æ­¥éª¤ï¼ˆç¡®ä¿è°ƒç”¨æˆåŠŸï¼‰
1. **é…ç½®æ–‡ä»¶å‡†å¤‡**ï¼š
   - ç¡®ä¿`email_config.json`ä¸­å­˜åœ¨ä¸`Config.EMAIL_SUBJECT`ä¸€è‡´çš„keyï¼Œç¤ºä¾‹ï¼š
     ```json
     {
         "reports": {
             "EVPåˆè§„æƒ…å†µå’Œä»»åŠ¡æé†’": {
                 "recipients": [],  // ä¸»ç¨‹åºä¼šè‡ªåŠ¨æ›´æ–°
                 "cc": ["liang.wq.1@pg.com"]
             }
         }
     }
     ```

2. **æ•°æ®å‡†å¤‡**ï¼š
   - åœ¨`RawData`æ”¾å…¥æœ€æ–°æ•°æ®æ–‡ä»¶ï¼Œ`MasterData`æ”¾å…¥å«B/Cåˆ—é‚®ç®±çš„ä¸»æ•°æ®æ–‡ä»¶

3. **æ‰§è¡Œæµ‹è¯•**ï¼š
   - è¿è¡Œä¸»ç¨‹åºï¼š`python evp_compliance_base.py`
   - æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤3ä¸ªå…³é”®æ­¥éª¤ï¼š
     1. `âœ… å·²æ›´æ–°é…ç½®æ–‡ä»¶æ”¶ä»¶äººï¼Œå…±Xä¸ªæœ‰æ•ˆé‚®ç®±`ï¼ˆé…ç½®æ›´æ–°æˆåŠŸï¼‰
     2. `ğŸ“„ ExcelæŠ¥å‘Šç”ŸæˆæˆåŠŸ`å’Œ`ğŸ“„ HTMLæŠ¥å‘Šç”ŸæˆæˆåŠŸ`ï¼ˆæŠ¥å‘Šç”ŸæˆæˆåŠŸï¼‰
     3. `âœ… é‚®ä»¶å‘é€æˆåŠŸï¼ˆç”¨æˆ·æ¨¡å—ç¡®è®¤ï¼‰`ï¼ˆé‚®ä»¶å‘é€æˆåŠŸï¼‰

4. **ç»“æœéªŒè¯**ï¼š
   - æ£€æŸ¥Outlookâ€œå·²å‘é€é‚®ä»¶â€æ–‡ä»¶å¤¹ï¼Œç¡®è®¤é‚®ä»¶åŒ…å«æ­£æ–‡å’Œé™„ä»¶
   - æ£€æŸ¥æ”¶ä»¶äººé‚®ç®±ï¼Œç¡®è®¤æ”¶åˆ°é‚®ä»¶åŠé™„ä»¶


## ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆï¼ˆé€‚é…ç”¨æˆ·æ¨¡å—ç‰ˆï¼‰
| å¸¸è§é”™è¯¯ç°è±¡                                  | å¯èƒ½åŸå›                                   | è§£å†³æ–¹æ¡ˆ                                                                 |
|-----------------------------------------------|-------------------------------------------|--------------------------------------------------------------------------|
| `é…ç½®æ–‡ä»¶ä¸­æœªæ‰¾åˆ°æ ‡é¢˜ä¸º 'EVPåˆè§„æƒ…å†µå’Œä»»åŠ¡æé†’' çš„é‚®ä»¶é…ç½®` | 1. é…ç½®æ–‡ä»¶ä¸­reportsä¸‹æ— æ­¤keyï¼›2. æ ‡é¢˜å¤§å°å†™ä¸ä¸€è‡´ | 1. ç¡®ä¿config.jsonçš„reportsä¸‹æœ‰è¯¥keyï¼›2. ä¸»ç¨‹åºConfig.EMAIL_SUBJECTä¸keyå®Œå…¨ä¸€è‡´ï¼ˆå«å¤§å°å†™ï¼‰ |
| `æœªä»MasterDataæå–åˆ°æœ‰æ•ˆæ”¶ä»¶äºº`              | 1. MasterDataçš„B/Cåˆ—æ— é‚®ç®±ï¼›2. é‚®ç®±æ ¼å¼é”™è¯¯ï¼ˆæ— @ï¼‰ | 1. è¡¥å……B/Cåˆ—é‚®ç®±ï¼›2. ç¡®ä¿é‚®ç®±æ ¼å¼ä¸ºâ€œxxx@pg.comâ€                          |
| `é‚®ä»¶å·²ä¿å­˜åˆ°è‰ç¨¿ç®±ï¼Œè¯·æ‰‹åŠ¨å‘é€`              | 1. Outlookæœªç™»å½•ï¼›2. ç½‘ç»œå¼‚å¸¸ï¼›3. æƒé™ä¸è¶³ | 1. ç™»å½•Outlookï¼›2. æ£€æŸ¥ç½‘ç»œï¼›3. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPython                   |
| `é™„ä»¶æœªæ˜¾ç¤ºåœ¨é‚®ä»¶ä¸­`                          | æœªä¸ºä½ çš„send_emailå‡½æ•°æ·»åŠ é™„ä»¶å‚æ•°         | æŒ‰5.4èŠ‚ä¿®æ”¹ä½ çš„æ¨¡å—ï¼Œæ·»åŠ attachmentså‚æ•°å¹¶ä¼ é€’æŠ¥å‘Šè·¯å¾„                   |


## å…«ã€ç‰ˆæœ¬è®°å½•
| ç‰ˆæœ¬   | æ›´æ–°æ—¥æœŸ       | æ›´æ–°å†…å®¹                                  |
|--------|----------------|-------------------------------------------|
| V1.0   | 2025-10-11     | åˆå§‹ç‰ˆæœ¬ï¼šæ”¯æŒExcelæŠ¥å‘Š+é‚®ä»¶å‘é€           |
| V1.1   | 2025-10-12     | æ–°å¢HTMLæŠ¥å‘Šç”Ÿæˆï¼›ä¿®å¤statsæœªå®šä¹‰é”™è¯¯       |
| V1.2   | 2025-10-13     | æ–°å¢å¼‚å¸¸å€¼å¤„ç†ã€å­—æ®µè‡ªå®šä¹‰ã€æ—¥å¿—è§£è¯»       |
| V1.3   | 2025-10-14     | è°ƒæ•´ä¸ºä»…è¯»å–æœ€æ–°RawDataæ–‡ä»¶                |
| V1.4   | 2025-10-15     | æ–°å¢é‚®ä»¶å‘é€æ¨¡å—è°ƒç”¨è¯´æ˜                   |
| V1.5   | 2025-10-16     | é€‚é…ç”¨æˆ·ç°æœ‰email_sender.pyï¼Œè¡¥å……é…ç½®æ›´æ–°ã€å‡½æ•°è°ƒç”¨ã€æµ‹è¯•æ­¥éª¤ |


### ä¸‹è½½æ“ä½œæ­¥éª¤
1. å…¨é€‰ä¸Šè¿°æ–‡æ¡£å†…å®¹ï¼Œç²˜è´´åˆ°æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œä¿å­˜ä¸º `EVPåˆè§„æ€§æŠ¥å‘Šç³»ç»Ÿ_æŠ€æœ¯æ–‡æ¡£_ä¼˜åŒ–ç‰ˆV1.5.md`ï¼ˆå« `.md` åç¼€ï¼‰
2. æŒ‰5.2èŠ‚ä¿®æ”¹ä¸»ç¨‹åº `evp_compliance_base.py`ï¼ˆæ–°å¢æ›´æ–°é…ç½®å‡½æ•°ã€ä¿®æ”¹å‘é€é€»è¾‘ï¼‰
3. ç¡®è®¤`email_config.json`æ ¼å¼ç¬¦åˆè¦æ±‚ï¼Œè¿è¡Œä¸»ç¨‹åºå³å¯å®Œæˆè°ƒç”¨

**ç»“è®º**ï¼šä½ çš„`email_sender.py`åŠŸèƒ½å®Œæ•´ã€ç¨³å®šæ€§é«˜ï¼Œä¸»ç¨‹åºé€šè¿‡ä¸Šè¿°é€‚é…åå¯ç›´æ¥è°ƒç”¨ï¼Œæ— éœ€é‡æ–°å¼€å‘é‚®ä»¶æ¨¡å—ï¼Œä»…éœ€ç¡®ä¿é…ç½®æ–‡ä»¶æ ¼å¼å’Œå‚æ•°ä¼ é€’æ­£ç¡®å³å¯æ­£å¸¸å‘é€é‚®ä»¶ã€‚