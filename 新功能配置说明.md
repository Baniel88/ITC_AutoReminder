# ITC报表自动下载系统 - 配置说明

## 📧 邮件发送控制选项

### 主要配置变量
```python
EMAIL_ENABLED = True           # 启用/禁用邮件功能
EMAIL_AUTO_SEND = False        # 预览模式(False) 或 自动发送(True)  
SEND_COMPLETION_EMAIL = False  # 完成通知邮件控制
```

## 📱 Teams通知集成

### 主要配置变量
```python
TEAMS_ENABLED = False          # 启用/禁用Teams通知
TEAMS_SEND_COMPLETION = False  # Teams完成通知控制
```

### Teams配置文件 (teams_config.json)
```json
{
    "enabled": true,
    "webhooks": {
        "itc_notifications": "你的Webhook URL"
    },
    "team_members": {
        "itc_team": ["user@pg.com"]
    }
}
```

## 🔔 通知发送逻辑

### 双渠道通知策略
- **有问题时必发**: 发现紧急或待处理项目时，同时发送邮件和Teams通知
- **完成通知可选**: 
  - `SEND_COMPLETION_EMAIL=True`: 发送邮件完成通知
  - `TEAMS_SEND_COMPLETION=True`: 发送Teams完成通知
- **独立控制**: 邮件和Teams可以独立启用/禁用

### 智能内容适配
- **邮件**: 详细HTML格式，包含完整数据统计
- **Teams**: 简洁卡片格式，突出关键信息
- **紧急程度自动调整**: 根据问题严重程度自动调整颜色和语调

## ♻️ Chrome窗口管理

### 主要配置变量
```python
REUSE_EXISTING_CHROME = True   # 重用现有Chrome窗口
CLOSE_CHROME_ON_EXIT = False   # 程序结束时是否关闭Chrome
```

### Chrome管理特性
- **智能检测**: 自动检测已运行的Chrome调试会话
- **端口重用**: 重用现有调试端口，避免冲突
- **多项目隔离**: ITC使用端口9233-9242，EVP使用9222-9232
- **用户数据隔离**: 每个端口对应独立的用户数据目录

### Chrome行为说明
- `REUSE_EXISTING_CHROME=True`: 优先使用已打开的Chrome窗口
- `REUSE_EXISTING_CHROME=False`: 总是打开新的Chrome实例
- `CLOSE_CHROME_ON_EXIT=True`: 程序结束时尝试关闭Chrome
- `CLOSE_CHROME_ON_EXIT=False`: 保持Chrome运行供下次重用

## 🔧 端口分配策略

### ITC项目端口范围
- **起始端口**: 9233
- **结束端口**: 9242  
- **项目标识**: ITC_Scorecard
- **避免冲突**: 与EVP项目(9222-9232)完全隔离

### 端口分配流程
1. 检查配置中的重用设置
2. 如果启用重用，优先查找已有调试会话
3. 如果无可重用会话，在指定范围内分配新端口
4. 为每个端口创建独立的用户数据目录

## 📁 用户数据目录结构
```
chrome_debug_profile_itc_9233/
chrome_debug_profile_itc_9234/
chrome_debug_profile_itc_9235/
...
chrome_debug_profile_itc_9242/
```

## 🎯 推荐配置

### 开发/测试环境
```python
EMAIL_ENABLED = True
EMAIL_AUTO_SEND = False        # 预览模式，方便调试
SEND_COMPLETION_EMAIL = True   # 查看所有邮件内容
REUSE_EXISTING_CHROME = True   # 提高开发效率
CLOSE_CHROME_ON_EXIT = False   # 保持浏览器状态
```

### 生产/自动化环境
```python
EMAIL_ENABLED = True
EMAIL_AUTO_SEND = True         # 自动发送
SEND_COMPLETION_EMAIL = False  # 只发送有问题的通知
REUSE_EXISTING_CHROME = True   # 提高性能
CLOSE_CHROME_ON_EXIT = True    # 清理资源
```

### 静默运行环境
```python
EMAIL_ENABLED = False          # 禁用邮件
REUSE_EXISTING_CHROME = True
CLOSE_CHROME_ON_EXIT = True
```

## ⚠️ 注意事项

1. **邮件配置优先级**: email_config.json > 主文件配置 > 默认值
2. **Chrome进程管理**: 自动关闭功能需要psutil库支持
3. **端口冲突**: 确保ITC和EVP项目使用不同的端口范围
4. **用户数据**: Chrome用户数据目录会保存登录状态和设置
5. **网络环境**: 确保能够访问ITC系统和Outlook服务